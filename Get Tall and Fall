local player = game:GetService("Players").LocalPlayer
local pg = player:WaitForChild("PlayerGui")
local UIS = game:GetService("UserInputService")

local running = false
local firstEggAmount = 1 -- default value

-- MAIN GUI
local gui = Instance.new("ScreenGui", pg)
gui.Name = "ToggleGUI"

-- Input Box (smaller)
local inputBox = Instance.new("TextBox", gui)
inputBox.Size = UDim2.new(0, 120, 0, 30)
inputBox.Position = UDim2.new(0.5, -60, 0.4, 0)
inputBox.PlaceholderText = "Enter number"
inputBox.Text = tostring(firstEggAmount)
inputBox.ClearTextOnFocus = false
inputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
inputBox.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Fire Button under the textbox
local fireButton = Instance.new("TextButton", gui)
fireButton.Size = UDim2.new(0, 120, 0, 30)
fireButton.Position = UDim2.new(0.5, -60, 0.46, 0)
fireButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
fireButton.Text = "Give Trophy"

-- Toggle Button
local toggleButton = Instance.new("TextButton", gui)
toggleButton.Size = UDim2.new(0, 120, 0, 30)
toggleButton.Position = UDim2.new(0.5, -60, 0.52, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
toggleButton.Text = "OFF"

-- DRAGGING both GUIs together
local dragging = false
local dragStart, startPosInput, startPosFire, startPosToggle

local function update(input)
	local delta = input.Position - dragStart
	inputBox.Position = UDim2.new(startPosInput.X.Scale, startPosInput.X.Offset + delta.X,
	                               startPosInput.Y.Scale, startPosInput.Y.Offset + delta.Y)
	fireButton.Position = UDim2.new(startPosFire.X.Scale, startPosFire.X.Offset + delta.X,
	                                 startPosFire.Y.Scale, startPosFire.Y.Offset + delta.Y)
	toggleButton.Position = UDim2.new(startPosToggle.X.Scale, startPosToggle.X.Offset + delta.X,
	                                  startPosToggle.Y.Scale, startPosToggle.Y.Offset + delta.Y)
end

for _, obj in pairs({inputBox, fireButton, toggleButton}) do
	obj.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or
		   input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPosInput = inputBox.Position
			startPosFire = fireButton.Position
			startPosToggle = toggleButton.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	obj.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or
		   input.UserInputType == Enum.UserInputType.Touch then
			if dragging then
				update(input)
			end
		end
	end)
end

-- FIRE BUTTON functionality
fireButton.MouseButton1Click:Connect(function()
	local num = tonumber(inputBox.Text)
	if num then
		firstEggAmount = -math.abs(num)
		local argsFirst = {
			[1] = {
				eggName = "egg1",
				kind = "eggOpenRequest",
				muchOpen = firstEggAmount
			}
		}
		game:GetService("ReplicatedStorage")
			.Packages.Knit.Services.EggService.RE.remote:FireServer(unpack(argsFirst))
	end
end)

-- TOGGLE BUTTON functionality
toggleButton.MouseButton1Click:Connect(function()
	running = not running
	toggleButton.Text = running and "ON" or "OFF"
	toggleButton.BackgroundColor3 = running and Color3.fromRGB(0, 170, 0) or Color3.fromRGB(170, 0, 0)
end)

-- LOOP for normal eggs
task.spawn(function()
	while true do
		if running then
			local argsLoop = {
				[1] = {
					eggName = "robuxEgg5",
					kind = "eggOpenRequest",
					muchOpen = 1
				}
			}
			game:GetService("ReplicatedStorage")
				.Packages.Knit.Services.EggService.RE.remote:FireServer(unpack(argsLoop))
		end
		task.wait(2)
	end
end)
