-- Remove old GUI
if game.CoreGui:FindFirstChild("BrainrotGUI") then
    game.CoreGui.BrainrotGUI:Destroy()
end

getgenv().BrainrotLoop = false

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local returnPosition = CFrame.new(32, 4, -243)

-- Destroy Traps first
if workspace:FindFirstChild("Traps") then
    workspace.Traps:Destroy()
end

-- Priority Order
local priorities = {"Divine", "Celestial", "Secret"}

-- Get highest priority brainrot
local function getPriorityBrainrot()
    for _, rarityName in ipairs(priorities) do
        for _, brainrot in pairs(workspace.Brainrots:GetChildren()) do
            local guiObj = brainrot:FindFirstChild("Gui")
            if guiObj then
                local rarity = guiObj:FindFirstChild("Rarity")
                if rarity then
                    local value
                    if rarity:IsA("StringValue") then
                        value = rarity.Value
                    elseif rarity:IsA("TextLabel") then
                        value = rarity.Text
                    end

                    if value == rarityName then
                        return brainrot
                    end
                end
            end
        end
    end
    return nil
end

-- ðŸ”¥ Instant fire
local function fireInstant(prompt)
    if not prompt then return end
    
    prompt.Enabled = true
    prompt.HoldDuration = 0
    prompt.MaxActivationDistance = 20
    
    fireproximityprompt(prompt, 0)
end

-- Main Loop
local function startLoop()
    task.spawn(function()
        while getgenv().BrainrotLoop do
            
            local brainrot = getPriorityBrainrot()
            if brainrot then
                local part = brainrot:FindFirstChildWhichIsA("BasePart", true)
                if part then
                    -- TP
                    hrp.CFrame = part.CFrame + Vector3.new(0,3,0)
                    task.wait(0.15)

                    -- Find prompt
                    local prompt = brainrot:FindFirstChildWhichIsA("ProximityPrompt", true)
                    fireInstant(prompt)

                    -- Return
                    task.wait(0.1)
                    hrp.CFrame = returnPosition
                end
            end

            task.wait(0.4)
        end
    end)
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "BrainrotGUI"
gui.Parent = game.CoreGui

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,160,0,60)
frame.Position = UDim2.new(0,20,0,200)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Active = true
frame.Draggable = true

local button = Instance.new("TextButton", frame)
button.Size = UDim2.new(1,0,1,0)
button.Text = "Brainrot: OFF"
button.BackgroundColor3 = Color3.fromRGB(200,50,50)
button.TextColor3 = Color3.new(1,1,1)
button.TextScaled = true

button.MouseButton1Click:Connect(function()
    getgenv().BrainrotLoop = not getgenv().BrainrotLoop
    
    if getgenv().BrainrotLoop then
        button.Text = "Brainrot: ON"
        button.BackgroundColor3 = Color3.fromRGB(50,200,50)
        startLoop()
    else
        button.Text = "Brainrot: OFF"
        button.BackgroundColor3 = Color3.fromRGB(200,50,50)
    end
end)
